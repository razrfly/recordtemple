<%# Gem Card - Larger card with audio preview capability %>
<div class="group bg-white rounded-2xl shadow-sm ring-1 ring-olive-900/5 overflow-hidden hover:shadow-xl hover:ring-olive-900/10 transition-all duration-300"
     data-controller="audio-player">

  <audio data-audio-player-target="audio" class="hidden"
         data-action="timeupdate->audio-player#timeUpdate loadedmetadata->audio-player#loadedMetadata ended->audio-player#ended"></audio>

  <%= link_to record_path(record), class: "block", data: { turbo_frame: "_top" } do %>
    <div class="relative aspect-square bg-olive-100 image-skeleton">
      <% if record.cover %>
        <%= image_tag cdn_image_url(record.cover.variant(ImageVariants::CARD)),
            class: "w-full h-full object-cover group-hover:scale-[1.02] transition-transform duration-500 image-loading",
            alt: record.artist_name || "Album cover",
            loading: "lazy",
            decoding: "async",
            data: { controller: "image-loader", action: "load->image-loader#loaded error->image-loader#error" } %>
      <% end %>

      <%# Gem badge %>
      <div class="absolute top-3 left-3 bg-amber-500 text-white px-2 py-0.5 rounded-full text-xs font-semibold uppercase tracking-wide shadow-lg flex items-center gap-1">
        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        Gem
      </div>

      <%# Audio indicator %>
      <% if record.songs.attached? && record.songs.any? %>
        <div class="absolute bottom-3 right-3 bg-olive-950/80 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
            <path d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2z"/>
          </svg>
          <%= record.songs.size %>
        </div>
      <% end %>
    </div>
  <% end %>

  <div class="p-4">
    <h3 class="font-display text-lg text-olive-950 truncate">
      <%= link_to record.artist_name || "Unknown Artist", record_path(record),
          class: "hover:text-olive-700 transition-colors" %>
    </h3>
    <p class="text-sm text-olive-600 truncate mt-1">
      <%= record.label_name.presence || "Unknown Label" %>
    </p>

    <% if record.songs.attached? && record.songs.any? %>
      <div class="mt-3 pt-3 border-t border-olive-100" data-audio-player-target="track">
        <%# Play button %>
        <button type="button"
                data-audio-player-target="playButton"
                data-action="click->audio-player#play"
                data-track-index="0"
                data-audio-url="<%= rails_blob_url(record.songs.first) %>"
                class="w-full flex items-center gap-3 text-sm text-olive-600 hover:text-olive-900 transition-colors group/play">
          <span class="flex items-center justify-center w-9 h-9 rounded-full bg-olive-100 group-hover/play:bg-olive-200 transition-colors flex-shrink-0">
            <svg class="w-4 h-4 ml-0.5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </span>
          <span class="truncate text-left flex-1"><%= record.songs.first.filename.to_s.gsub(/\.mp3$/i, '') %></span>
        </button>

        <%# Pause button (hidden by default) %>
        <button type="button"
                data-audio-player-target="pauseButton"
                data-action="click->audio-player#pause"
                class="hidden w-full items-center gap-3 text-sm text-olive-900 group/pause">
          <span class="flex items-center justify-center w-9 h-9 rounded-full bg-olive-200 flex-shrink-0">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
          </span>
          <div class="flex-1 min-w-0">
            <span class="truncate block text-left"><%= record.songs.first.filename.to_s.gsub(/\.mp3$/i, '') %></span>
            <div class="mt-1 h-1 bg-olive-200 rounded-full overflow-hidden">
              <div data-audio-player-target="progress" class="h-full bg-olive-600 rounded-full transition-all" style="width: 0%"></div>
            </div>
          </div>
        </button>
      </div>
    <% end %>
  </div>
</div>
