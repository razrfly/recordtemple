<% session_key_name = Rails.application.config.session_options[:key] %>

<script type="text/javascript">
  $(function() { 

    $('.uploadifiable_songs').uploadify ({
	  buttonText      : 'Upload Songs!',
      script          : '<%= record_songs_path(@record) %>',
      uploader        : '/flash/uploadify.swf',
	  onAllComplete   : function(event,data) {
	      					$.getScript('<%= record_songs_path(@record, :format => "js") %>');
	  					},
      multi           : true,
      auto            : true,
	  fileExt         : '*.mp3;',
      cancelImg       : '/images/cancel.png',
	  scriptData      : {
					        '_http_accept': 'application/javascript',
							'format' : 'json',
					        '_method': 'post',
							'<%= session_key_name %>' : encodeURIComponent('<%= u cookies[session_key_name] %>'),
					        'authenticity_token': encodeURIComponent('<%= u form_authenticity_token %>')
	      				}
    });

    $('.uploadifiable_photos').uploadify ({
	  buttonText      : 'Upload Photos!',
      script          : '<%= record_photos_path(@record) %>',
      uploader        : '/flash/uploadify.swf',
	  onAllComplete   : function(event,data) {
	      					$.getScript('<%= record_photos_path(@record, :format => "js") %>');
	  					},
      multi           : true,
      auto            : true,
	  fileExt         : '*.png;*.jpg;',
	  cancelImg       : '/images/cancel.png',  //take care that the image is accessible
      scriptData      : {
					        '_http_accept': 'application/javascript',
							'format' : 'json',
					        '_method': 'post',
							'<%= session_key_name %>' : encodeURIComponent('<%= u cookies[session_key_name] %>'),
					        'authenticity_token': encodeURIComponent('<%= u form_authenticity_token %>')
	      				}
      

    });
  });
</script>


<%= semantic_form_for [:admin, @record], :html => { :multipart => true } do |f| %>
	<%= f.semantic_fields_for :songs, @record.songs.build do |song_form| %>
		<%= song_form.input :mp3, :label => 'mp3s', :input_html => { :class => 'uploadifiable_songs' } %>
	<% end %>
	<%= f.semantic_fields_for :photos, @record.photos.build do |photo_form| %>
		<%= photo_form.input :data, :label => 'photos', :input_html => { :class => 'uploadifiable_photos' } %>
	<% end %>
	<%#= f.buttons :commit %>
<% end %>