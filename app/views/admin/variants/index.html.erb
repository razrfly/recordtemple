<div class="min-h-screen" data-controller="auto-refresh" data-auto-refresh-interval-value="5000" data-auto-refresh-url-value="<%= stats_admin_variants_path %>">
  <div class="max-w-6xl mx-auto px-6 py-12 lg:px-10">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-10">
      <div>
        <h1 class="font-display text-4xl text-olive-950 dark:text-white">Variant Warmup</h1>
        <p class="mt-2 text-olive-600 dark:text-olive-400">Monitor and control image variant generation</p>
      </div>
      <%= link_to "/admin/sidekiq", class: "inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-olive-700 hover:text-olive-900 bg-olive-200/50 hover:bg-olive-200 rounded-full transition-colors dark:text-olive-300 dark:hover:text-white dark:bg-olive-800/50 dark:hover:bg-olive-800", target: "_blank" do %>
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
        </svg>
        Sidekiq Dashboard
      <% end %>
    </div>

    <% if flash[:notice] %>
      <div class="mb-8 p-4 bg-olive-200/50 border border-olive-300 text-olive-800 rounded-xl dark:bg-olive-800/30 dark:border-olive-700 dark:text-olive-200">
        <div class="flex items-center gap-3">
          <svg class="w-5 h-5 text-olive-600 dark:text-olive-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <%= flash[:notice] %>
        </div>
      </div>
    <% end %>

    <!-- Stats Section (Turbo Frame for auto-refresh) -->
    <%= turbo_frame_tag "variant-stats" do %>
      <%= render "stats", stats: @stats %>
    <% end %>

    <!-- Actions -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mt-12 pt-10 border-t border-olive-200 dark:border-olive-800">
      <div class="flex flex-wrap gap-3">
        <%= form_with url: warmup_admin_variants_path, method: :post, data: { turbo_confirm: "This will queue #{number_with_delimiter(@stats[:total_blobs])} warmup jobs for all images. Continue?" } do %>
          <%= ui_button "Start Warmup", variant: :primary, size: :lg, type: :submit %>
        <% end %>

        <% if @stats[:retry_count] > 0 %>
          <%= form_with url: clear_retries_admin_variants_path, method: :post, data: { turbo_confirm: "Clear #{number_with_delimiter(@stats[:retry_count])} failed jobs from retry queue?" } do %>
            <%= ui_button "Clear Retries", variant: :danger, size: :lg, type: :submit %>
          <% end %>
        <% end %>
      </div>

      <div class="flex items-center gap-2 text-sm text-olive-500 dark:text-olive-400">
        <span class="relative flex h-2 w-2">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-olive-400 opacity-75 dark:bg-olive-500"></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-olive-500 dark:bg-olive-400"></span>
        </span>
        Auto-refreshing every 5s
      </div>
    </div>
  </div>
</div>
