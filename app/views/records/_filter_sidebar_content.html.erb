<%= form_with url: records_path, method: :get, data: { turbo_frame: "records_list", turbo_action: "advance" } do |f| %>
  <input type="hidden" name="sort" value="<%= params[:sort] %>">

  <div class="flex items-center justify-between mb-6">
    <% if params[:q].present? || params[:has_images].present? || params[:has_audio].present? %>
      <%= link_to records_path, class: "text-sm text-olive-500 hover:text-olive-700" do %>
        Clear all
      <% end %>
    <% end %>
  </div>

  <div class="space-y-6">
    <div>
      <label for="search" class="block text-sm font-medium text-olive-700 mb-2">Search</label>
      <div class="relative">
        <input type="text"
               name="q[artist_name_or_label_name_or_comment_cont]"
               value="<%= params.dig(:q, :artist_name_or_label_name_or_comment_cont) %>"
               placeholder="Artist, label, notes..."
               class="w-full pl-9 pr-4 py-2.5 text-sm bg-olive-50 border-0 rounded-xl text-olive-900 placeholder-olive-400 focus:ring-2 focus:ring-olive-500 focus:bg-white transition-colors">
        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-olive-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </div>
    </div>

    <div data-controller="filter-toggle">
      <button type="button"
              data-action="click->filter-toggle#toggle"
              class="flex items-center justify-between w-full text-sm font-medium text-olive-700 mb-3">
        <span>Genre</span>
        <svg data-filter-toggle-target="icon" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <div data-filter-toggle-target="content" class="space-y-2">
        <% @genres.first(8).each do |genre| %>
          <label class="flex items-center gap-3 cursor-pointer group">
            <input type="checkbox"
                   name="q[genre_id_in][]"
                   value="<%= genre[:id] %>"
                   <%= "checked" if params.dig(:q, :genre_id_in)&.include?(genre[:id].to_s) %>
                   class="w-4 h-4 rounded border-olive-300 text-olive-600 focus:ring-olive-500">
            <span class="flex-1 text-sm text-olive-600 group-hover:text-olive-900 truncate"><%= genre[:name] %></span>
            <span class="text-xs text-olive-400"><%= number_with_delimiter(genre[:count]) %></span>
          </label>
        <% end %>
        <% if @genres.length > 8 %>
          <button type="button"
                  data-action="click->filter-toggle#showMore"
                  data-filter-toggle-target="showMoreBtn"
                  class="text-sm text-olive-500 hover:text-olive-700 mt-2">
            Show <%= @genres.length - 8 %> more...
          </button>
          <div data-filter-toggle-target="moreContent" class="hidden space-y-2">
            <% @genres.drop(8).each do |genre| %>
              <label class="flex items-center gap-3 cursor-pointer group">
                <input type="checkbox"
                       name="q[genre_id_in][]"
                       value="<%= genre[:id] %>"
                       <%= "checked" if params.dig(:q, :genre_id_in)&.include?(genre[:id].to_s) %>
                       class="w-4 h-4 rounded border-olive-300 text-olive-600 focus:ring-olive-500">
                <span class="flex-1 text-sm text-olive-600 group-hover:text-olive-900 truncate"><%= genre[:name] %></span>
                <span class="text-xs text-olive-400"><%= number_with_delimiter(genre[:count]) %></span>
              </label>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="border-t border-olive-100 pt-6" data-controller="filter-toggle">
      <button type="button"
              data-action="click->filter-toggle#toggle"
              class="flex items-center justify-between w-full text-sm font-medium text-olive-700 mb-3">
        <span>Format</span>
        <svg data-filter-toggle-target="icon" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <div data-filter-toggle-target="content" class="space-y-2">
        <% @formats.each do |format| %>
          <label class="flex items-center gap-3 cursor-pointer group">
            <input type="checkbox"
                   name="q[record_format_id_in][]"
                   value="<%= format[:id] %>"
                   <%= "checked" if params.dig(:q, :record_format_id_in)&.include?(format[:id].to_s) %>
                   class="w-4 h-4 rounded border-olive-300 text-olive-600 focus:ring-olive-500">
            <span class="flex-1 text-sm text-olive-600 group-hover:text-olive-900 truncate"><%= format[:name] %></span>
            <span class="text-xs text-olive-400"><%= number_with_delimiter(format[:count]) %></span>
          </label>
        <% end %>
      </div>
    </div>

    <div class="border-t border-olive-100 pt-6" data-controller="filter-toggle">
      <button type="button"
              data-action="click->filter-toggle#toggle"
              class="flex items-center justify-between w-full text-sm font-medium text-olive-700 mb-3">
        <span>Condition</span>
        <svg data-filter-toggle-target="icon" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <div data-filter-toggle-target="content" class="space-y-2">
        <% @conditions.each do |cond| %>
          <label class="flex items-center gap-3 cursor-pointer group">
            <input type="checkbox"
                   name="q[condition_in][]"
                   value="<%= cond[:value] %>"
                   <%= "checked" if params.dig(:q, :condition_in)&.include?(cond[:value].to_s) %>
                   class="w-4 h-4 rounded border-olive-300 text-olive-600 focus:ring-olive-500">
            <span class="flex-1 text-sm text-olive-600 group-hover:text-olive-900"><%= cond[:value]&.titleize || "Unknown" %></span>
            <span class="text-xs text-olive-400"><%= number_with_delimiter(cond[:count]) %></span>
          </label>
        <% end %>
      </div>
    </div>

    <div class="border-t border-olive-100 pt-6">
      <p class="text-sm font-medium text-olive-700 mb-3">Media</p>
      <div class="space-y-2">
        <label class="flex items-center gap-3 cursor-pointer group">
          <input type="checkbox"
                 name="has_images"
                 value="1"
                 <%= "checked" if params[:has_images] == "1" %>
                 class="w-4 h-4 rounded border-olive-300 text-olive-600 focus:ring-olive-500">
          <span class="flex-1 text-sm text-olive-600 group-hover:text-olive-900">Has Images</span>
          <span class="text-xs text-olive-400"><%= number_with_delimiter(@has_images_count) %></span>
        </label>
        <label class="flex items-center gap-3 cursor-pointer group">
          <input type="checkbox"
                 name="has_audio"
                 value="1"
                 <%= "checked" if params[:has_audio] == "1" %>
                 class="w-4 h-4 rounded border-olive-300 text-olive-600 focus:ring-olive-500">
          <span class="flex-1 text-sm text-olive-600 group-hover:text-olive-900">
            Has Audio
            <svg class="inline w-3.5 h-3.5 ml-1 text-olive-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
            </svg>
          </span>
          <span class="text-xs text-olive-400"><%= number_with_delimiter(@has_audio_count) %></span>
        </label>
      </div>
    </div>

    <div class="pt-4">
      <button type="submit"
              class="w-full py-2.5 px-4 bg-olive-950 text-white text-sm font-medium rounded-xl hover:bg-olive-800 transition-colors">
        Apply Filters
      </button>
    </div>
  </div>
<% end %>
